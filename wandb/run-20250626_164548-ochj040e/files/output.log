/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
loading num parts:  1
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
loading num parts:  2
loading num parts:  3
loading num parts:  4
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
num_shots is  16
num_shots is  16

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.54it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.07it/s]
Epoch 1 best val f1 0.4535 test f1 0.35867616534233093

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 2 best val f1 0.4709 test f1 0.4451940953731537
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 3 Loss: 0.6691
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 4 Loss: 0.6586
Epoch 5 Loss: 0.6482
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.12it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.31it/s]
Epoch 8 Loss: 0.6201
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.34it/s]
Epoch 9 Loss: 0.6123
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 10 Loss: 0.6035
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 11 Loss: 0.5961
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.09it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.08it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 15 Loss: 0.5721
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 16 Loss: 0.5667
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 17 Loss: 0.5618
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.08it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 21 Loss: 0.5476
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 22 Loss: 0.5418
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 23 Loss: 0.5376
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 27 Loss: 0.5286
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 28 Loss: 0.5225
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 29 Loss: 0.5220
Epoch 30 Loss: 0.5218
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.09it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 33 Loss: 0.5166
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 34 Loss: 0.5167
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 35 Loss: 0.5146
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 36 Loss: 0.5148
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.09it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.08it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 40 Loss: 0.5083
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 41 Loss: 0.5093
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 42 Loss: 0.5050
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.09it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 46 Loss: 0.5011
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 47 Loss: 0.5035
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 48 Loss: 0.5001
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 52 Loss: 0.4973
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 53 Loss: 0.4976
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 54 Loss: 0.4988
Epoch 55 Loss: 0.4981
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.09it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 58 Loss: 0.4939
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 59 Loss: 0.4943
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 60 Loss: 0.4982
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 61 Loss: 0.4949
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.07it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 65 Loss: 0.4939
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 66 Loss: 0.4967
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 67 Loss: 0.4910
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.05it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 71 Loss: 0.4902
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 72 Loss: 0.4928
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 73 Loss: 0.4890
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 74 Loss: 0.4870
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.06it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 77 Loss: 0.4900
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 78 Loss: 0.4862
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 79 Loss: 0.4872
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 80 Loss: 0.4855
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.36it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.08it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 84 Loss: 0.4842
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 85 Loss: 0.4864
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.37it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 86 Loss: 0.4873
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.37it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.34it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 90 Loss: 0.4838
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 91 Loss: 0.4820
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 92 Loss: 0.4816
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 93 Loss: 0.4842
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.09it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 96 Loss: 0.4817
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 97 Loss: 0.4811
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 98 Loss: 0.4823
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 99 Loss: 0.4812
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.37it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.37it/s]