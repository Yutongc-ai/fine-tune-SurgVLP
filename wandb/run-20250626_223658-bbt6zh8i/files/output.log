/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
loading num parts:  1
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
loading num parts:  2
loading num parts:  3
loading num parts:  4
num_shots is  16
num_shots is  16
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.64it/s]
Epoch 1 Loss: 0.6883
Epoch 1 best val f1 0.4971 test f1 0.4394071400165558
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.11it/s]
Epoch 2 Loss: 0.6714
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.93it/s]
Epoch 2 best val f1 0.5062 test f1 0.4451940953731537
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 5 Loss: 0.6253
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 6 Loss: 0.6118
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.18it/s]
Epoch 7 Loss: 0.5986
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.16it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 9 Loss: 0.5767
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.94it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 13 Loss: 0.5389
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
Epoch 14 Loss: 0.5295
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 15 Loss: 0.5210
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.13it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 17 Loss: 0.5047
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.94it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
Epoch 21 Loss: 0.4773
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 22 Loss: 0.4706
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 23 Loss: 0.4655
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 25 Loss: 0.4531
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 28 Loss: 0.4368
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 29 Loss: 0.4311
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 30 Loss: 0.4251
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
Epoch 31 Loss: 0.4199
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 33 Loss: 0.4101
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 37 Loss: 0.3894
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.10it/s]
Epoch 38 Loss: 0.3837
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 39 Loss: 0.3796
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 41 Loss: 0.3699
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  2.00it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.77it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 46 Loss: 0.3482
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 47 Loss: 0.3454
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 48 Loss: 0.3396
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.19it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 50 Loss: 0.3315
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.94it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 53 Loss: 0.3185
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 54 Loss: 0.3152
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 55 Loss: 0.3125
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 56 Loss: 0.3068
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 58 Loss: 0.3023
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.99it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 60 best val f1 0.5138 test f1 0.4451940953731537
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.02it/s]
Epoch 61 Loss: 0.2891
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 62 Loss: 0.2876
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 63 Loss: 0.2828
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 63 best val f1 0.5228 test f1 0.4451940953731537

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.18it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 64 best val f1 0.5273 test f1 0.4451940953731537
Epoch 65 Loss: 0.2771
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 66 Loss: 0.2730
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 67 Loss: 0.2700
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.11it/s]
Epoch 68 Loss: 0.2659
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 69 Loss: 0.2646
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.81it/s]
Epoch 69 best val f1 0.5317 test f1 0.4451940953731537

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.15it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 70 best val f1 0.5345 test f1 0.4451940953731537
Epoch 71 Loss: 0.2589
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 72 Loss: 0.2542
  0%|                                                                          | 0/2 [00:00<?, ?it/s]

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
Epoch 73 Loss: 0.2508
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 73 best val f1 0.5405 test f1 0.4451940953731537
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.86it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.82it/s]

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.13it/s]
Epoch 75 best val f1 0.5449 test f1 0.4451940953731537
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 76 Loss: 0.2430
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.15it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 77 Loss: 0.2401
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.93it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 81 Loss: 0.2296
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 82 Loss: 0.2261
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 83 Loss: 0.2252
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 83 best val f1 0.5493 test f1 0.4451940953731537
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.80it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 87 Loss: 0.2156
Epoch 87 best val f1 0.5519 test f1 0.4451940953731537
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 88 Loss: 0.2114
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 89 Loss: 0.2089
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.18it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 91 best val f1 0.5546 test f1 0.4451940953731537
Epoch 92 Loss: 0.2025
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 93 Loss: 0.2019
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 94 Loss: 0.2011
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
Epoch 96 Loss: 0.1933
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
Epoch 96 best val f1 0.5572 test f1 0.4451940953731537
Epoch 97 Loss: 0.1935
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
Epoch 98 Loss: 0.1913
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 99 Loss: 0.1870
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]