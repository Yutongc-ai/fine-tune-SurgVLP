/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
loading num parts:  1
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
loading num parts:  2
loading num parts:  3
loading num parts:  4
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
num_shots is  16
num_shots is  16

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.82it/s]
Epoch 1 best val f1 0.5073 test f1 0.47519242763519287
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 2 best val f1 0.5153 test f1 0.4451940953731537
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.09it/s]
Epoch 3 Loss: 0.6670
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 4 Loss: 0.6557
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 5 Loss: 0.6459
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.41it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 8 Loss: 0.6172
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 9 Loss: 0.6087
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.41it/s]
Epoch 10 Loss: 0.6011
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.41it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 11 Loss: 0.5941
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.41it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.11it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.41it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 14 Loss: 0.5751
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 15 Loss: 0.5668
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 16 Loss: 0.5618
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 17 Loss: 0.5573
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 20 Loss: 0.5438
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 21 Loss: 0.5410
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.41it/s]
Epoch 22 Loss: 0.5378
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 23 Loss: 0.5349
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 26 Loss: 0.5266
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 27 Loss: 0.5216
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 28 Loss: 0.5219
Epoch 29 Loss: 0.5204
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 32 Loss: 0.5136
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.37it/s]
Epoch 33 Loss: 0.5153
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 34 Loss: 0.5090
Epoch 35 Loss: 0.5109
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.08it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 38 Loss: 0.5062
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 39 Loss: 0.5034
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 40 Loss: 0.5039
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.09it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 43 Loss: 0.5047
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 44 Loss: 0.5017
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 45 Loss: 0.4994
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 46 Loss: 0.5012
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.08it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 50 Loss: 0.4966
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 51 Loss: 0.4962
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.31it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 53 Loss: 0.4957
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.07it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 56 Loss: 0.4945
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 57 Loss: 0.4920
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 59 Loss: 0.4947
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.11it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 62 Loss: 0.4901
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 63 Loss: 0.4925
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 65 Loss: 0.4905
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.08it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 68 Loss: 0.4879
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 69 Loss: 0.4888
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 71 Loss: 0.4891
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.11it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 74 Loss: 0.4875
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 75 Loss: 0.4870
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
Epoch 76 Loss: 0.4889
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 77 Loss: 0.4878
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.11it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
Epoch 80 Loss: 0.4830
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 81 Loss: 0.4841
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 83 Loss: 0.4862
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.38it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.08it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 86 Loss: 0.4836
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 87 Loss: 0.4813
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 89 Loss: 0.4834
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.10it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 92 Loss: 0.4818
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 93 Loss: 0.4790
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.40it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 94 Loss: 0.4780
Epoch 95 Loss: 0.4779
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.09it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.09it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 99 Loss: 0.4783
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.39it/s]
Epoch 100 Loss: 0.4757