/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
loading num parts:  1
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
loading num parts:  2
loading num parts:  3
loading num parts:  4
 14%|█████████▍                                                        | 1/7 [00:00<00:03,  1.59it/s]
num_shots is  64


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:04<00:00,  1.71it/s]
Epoch 1 Loss: 0.5910
Epoch 1 best val f1 0.5981 test f1 0.4050902724266052

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
 14%|█████████▍                                                        | 1/7 [00:00<00:03,  1.91it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
Epoch 3 Loss: -0.4738

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
 14%|█████████▍                                                        | 1/7 [00:00<00:03,  1.84it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.92it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.86it/s]
Epoch 5 best val f1 0.6618 test f1 0.423057496547699
Epoch 6 Loss: -1.6726

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
Epoch 8 Loss: -2.7932

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
Epoch 10 Loss: -4.0622

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 12 Loss: -5.4306

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 14 Loss: -6.8624

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.94it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]
Epoch 16 Loss: -8.3176

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 18 Loss: -9.8075

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]
Epoch 20 Loss: -11.3478

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 22 Loss: -12.8640

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 24 Loss: -14.4197


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]
Epoch 25 Loss: -15.1812
 14%|█████████▍                                                        | 1/7 [00:00<00:03,  1.90it/s]
Epoch 26 Loss: -15.9558
Epoch 27 Loss: -16.7737
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]
Epoch 29 Loss: -18.4442
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.92it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 31 Loss: -19.9910

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 33 Loss: -21.5693

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]
Epoch 35 Loss: -23.2183

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 36 Loss: -23.9712


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]
Epoch 37 Loss: -24.8669

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 39 Loss: -26.5030

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.94it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
Epoch 41 Loss: -28.1948

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.89it/s]
Epoch 43 Loss: -29.8048

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 45 Loss: -31.4972

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 47 Loss: -33.1953
Epoch 48 Loss: -34.0194
Epoch 49 Loss: -34.8641
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:01,  2.01it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 51 Loss: -36.5867

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 53 Loss: -38.3027

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 55 Loss: -39.9156

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 57 Loss: -41.5774

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 59 Loss: -43.1018

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 61 Loss: -44.9034

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 63 Loss: -46.5322

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 65 Loss: -48.2718

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 67 Loss: -49.9652

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 69 Loss: -51.7459

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 70 Loss: -52.6468


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 71 Loss: -53.4731

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 72 Loss: -54.3809

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 74 Loss: -56.1435

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 76 Loss: -57.7219

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  2.00it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 78 Loss: -59.2639

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 80 Loss: -61.1519

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 82 Loss: -62.8606

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 84 Loss: -64.6136

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 86 Loss: -66.2670

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 88 Loss: -67.9144

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 90 Loss: -69.7302

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
Epoch 92 Loss: -71.4955

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.90it/s]
Epoch 94 Loss: -73.2279
 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]
 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.91it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
 29%|██████████████████▊                                               | 2/7 [00:01<00:02,  1.91it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.93it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.93it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]
 14%|█████████▍                                                        | 1/7 [00:00<00:02,  2.03it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.99it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]
Epoch 100 Loss: -78.2944