/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
loading num parts:  1
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
loading num parts:  2
loading num parts:  3
loading num parts:  4
  0%|                                                                          | 0/7 [00:00<?, ?it/s]
num_shots is  64


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:04<00:00,  1.75it/s]
Epoch 1 Loss: 0.5573
 29%|██████████████████▊                                               | 2/7 [00:01<00:02,  1.88it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]
 14%|█████████▍                                                        | 1/7 [00:00<00:03,  1.64it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]
Epoch 3 Loss: -0.4985

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 4 Loss: -0.8616
Epoch 4 best val f1 0.6513 test f1 0.37234893441200256

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 5 Loss: -1.2445


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 6 Loss: -1.6771

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 7 Loss: -2.1654


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 8 Loss: -2.7121

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 9 Loss: -3.3024

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
Epoch 11 Loss: -4.5660
Epoch 12 Loss: -5.2177
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
 29%|██████████████████▊                                               | 2/7 [00:01<00:02,  2.00it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 15 Loss: -7.2144

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 17 Loss: -8.6254

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]
Epoch 19 Loss: -10.0049


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 20 Loss: -10.7684


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 21 Loss: -11.4941

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 23 Loss: -12.9115
Epoch 24 Loss: -13.6488
Epoch 25 Loss: -14.4280
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 26 Loss: -15.1985
Epoch 27 Loss: -15.9351
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 28 Loss: -16.7106
Epoch 29 Loss: -17.4758
Epoch 30 Loss: -18.2575
Epoch 31 Loss: -19.0374
Epoch 32 Loss: -19.7778

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 34 Loss: -21.3417

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 36 Loss: -22.8722

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 38 Loss: -24.4651

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 39 Loss: -25.2586


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 40 Loss: -26.0770
 29%|██████████████████▊                                               | 2/7 [00:00<00:02,  2.00it/s]
Epoch 41 Loss: -26.8965
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 43 Loss: -28.4347
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.96it/s]
Epoch 44 Loss: -29.2382

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 46 Loss: -30.8708
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 47 Loss: -31.6632
Epoch 48 Loss: -32.3695
Epoch 49 Loss: -33.1829
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]
Epoch 50 Loss: -34.0377
Epoch 51 Loss: -34.8402

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 53 Loss: -36.5366

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 55 Loss: -38.1067

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 57 Loss: -39.7435

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 59 Loss: -41.2944

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]
Epoch 61 Loss: -42.9128

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
Epoch 63 Loss: -44.5632
Epoch 64 Loss: -45.5159
Epoch 65 Loss: -46.3671
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]
Epoch 66 Loss: -47.0684

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 68 Loss: -48.7555
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.91it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.90it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]
Epoch 70 Loss: -50.4718

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]
Epoch 72 Loss: -52.1273

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 74 Loss: -53.8135

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]
Epoch 76 Loss: -55.4421

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.89it/s]
Epoch 78 Loss: -57.0927


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 79 Loss: -57.8937

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 80 Loss: -58.7658


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
Epoch 81 Loss: -59.6273

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.88it/s]
Epoch 82 Loss: -60.4061


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.87it/s]
Epoch 83 Loss: -61.0831


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.90it/s]
Epoch 84 Loss: -61.9693
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.87it/s]
Epoch 85 Loss: -62.8508


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.87it/s]
Epoch 86 Loss: -63.6326

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 88 Loss: -65.3659

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 90 Loss: -67.1790

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 92 Loss: -68.8658

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 94 Loss: -70.6113
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
 14%|█████████▍                                                        | 1/7 [00:00<00:03,  1.99it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
 14%|█████████▍                                                        | 1/7 [00:00<00:03,  1.96it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.97it/s]
 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.97it/s]
 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 100 Loss: -75.7301