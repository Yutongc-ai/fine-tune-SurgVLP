/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  2.90it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.37it/s]
loading num parts:  0
num_shots is  4
num_shots is  4
Epoch 1 Loss: 0.8542
Epoch 1 best val f1 0.1111 test f1 0.2031928449869156
Epoch 2 Loss: 0.1226
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.50it/s]
  0%|                                                                          | 0/1 [00:00<?, ?it/s]
Epoch 2 best val f1 0.3023 test f1 0.3847140371799469
Epoch 3 Loss: -0.2303
Epoch 3 best val f1 0.4124 test f1 0.5302567481994629
Epoch 4 Loss: -0.3399
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
  0%|                                                                          | 0/1 [00:00<?, ?it/s]
Epoch 5 Loss: -0.3858
Epoch 5 best val f1 0.4646 test f1 0.6201242208480835
Epoch 6 Loss: -0.4362
Epoch 7 Loss: -0.4835
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.50it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.47it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.47it/s]
Epoch 8 Loss: -0.5262
Epoch 9 Loss: -0.5678
Epoch 10 Loss: -0.6093
Epoch 11 Loss: -0.6510
Epoch 12 Loss: -0.6924
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.48it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.50it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.49it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.49it/s]
  0%|                                                                          | 0/1 [00:00<?, ?it/s]
Epoch 13 Loss: -0.7337
Epoch 14 Loss: -0.7749
Epoch 15 Loss: -0.8159
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.18it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
Epoch 17 Loss: -0.8985
Epoch 18 Loss: -0.9403
Epoch 19 Loss: -0.9831
Epoch 20 Loss: -1.0269
Epoch 21 Loss: -1.0717
Epoch 22 Loss: -1.1175
Epoch 23 Loss: -1.1638
Epoch 24 Loss: -1.2111
Epoch 25 Loss: -1.2588
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.45it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
  0%|                                                                          | 0/1 [00:00<?, ?it/s]
Epoch 26 Loss: -1.3073
Epoch 27 Loss: -1.3574
Epoch 28 Loss: -1.4082
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.50it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
Epoch 30 Loss: -1.5120
Epoch 31 Loss: -1.5653
Epoch 31 best val f1 0.4752 test f1 0.6917915344238281
Epoch 32 Loss: -1.6195
Epoch 33 Loss: -1.6748
Epoch 34 Loss: -1.7308
Epoch 35 Loss: -1.7878
Epoch 36 Loss: -1.8457
Epoch 37 Loss: -1.9052
Epoch 38 Loss: -1.9662
Epoch 39 Loss: -2.0283
Epoch 40 Loss: -2.0910
Epoch 40 best val f1 0.4808 test f1 0.6795515418052673
Epoch 41 Loss: -2.1552
Epoch 42 Loss: -2.2206
Epoch 43 Loss: -2.2870
Epoch 44 Loss: -2.3556
Epoch 45 Loss: -2.4273
Epoch 46 Loss: -2.5019
Epoch 47 Loss: -2.5790
Epoch 48 Loss: -2.6574
Epoch 49 Loss: -2.7374
Epoch 50 Loss: -2.8183
Epoch 51 Loss: -2.8996
Epoch 52 Loss: -2.9809
Epoch 53 Loss: -3.0627
Epoch 54 Loss: -3.1459
Epoch 55 Loss: -3.2303
Epoch 56 Loss: -3.3160
Epoch 57 Loss: -3.4019
Epoch 58 Loss: -3.4874
Epoch 59 Loss: -3.5745
Epoch 60 Loss: -3.6634
Epoch 61 Loss: -3.7519
Epoch 62 Loss: -3.8334
Epoch 63 Loss: -3.8763
Epoch 64 Loss: -3.9934
Epoch 65 Loss: -4.0968
Epoch 66 Loss: -4.1803
Epoch 67 Loss: -4.2651
Epoch 68 Loss: -4.3518
Epoch 69 Loss: -4.4394
Epoch 70 Loss: -4.5161
Epoch 71 Loss: -4.5900
Epoch 72 Loss: -4.6995
Epoch 73 Loss: -4.7922
Epoch 74 Loss: -4.8719
Epoch 75 Loss: -4.9608
Epoch 76 Loss: -5.0577
Epoch 77 Loss: -5.1584
Epoch 78 Loss: -5.2589
Epoch 79 Loss: -5.3582
Epoch 80 Loss: -5.4560
Epoch 81 Loss: -5.5496
Epoch 82 Loss: -5.6418
Epoch 83 Loss: -5.7419
Epoch 84 Loss: -5.8210
Epoch 85 Loss: -5.9251
Epoch 86 Loss: -6.0185
Epoch 87 Loss: -6.1181
Epoch 88 Loss: -6.2199
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.50it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.47it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.51it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.49it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.54it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.51it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.50it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.39it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.43it/s]
  0%|                                                                          | 0/1 [00:00<?, ?it/s]
Epoch 89 Loss: -6.3382
Epoch 90 Loss: -6.4508
Epoch 90 best val f1 0.4815 test f1 0.5478063821792603
Epoch 91 Loss: -6.5622
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.40it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.39it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.41it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.50it/s]
Epoch 93 Loss: -6.7615
Epoch 94 Loss: -6.8662
Epoch 95 Loss: -6.9669
Epoch 96 Loss: -7.0688
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.47it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.51it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
  0%|                                                                          | 0/1 [00:00<?, ?it/s]
Epoch 97 Loss: -7.1750
Epoch 98 Loss: -7.2948
Epoch 98 best val f1 0.4860 test f1 0.5420042872428894
Epoch 99 Loss: -7.4236
Epoch 99 best val f1 0.4906 test f1 0.5414847731590271
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.52it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.51it/s]
  0%|                                                                          | 0/1 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  4.53it/s]