/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
loading num parts:  1
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
loading num parts:  2
loading num parts:  3
loading num parts:  4
num_shots is  16
num_shots is  16
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.47it/s]

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.84it/s]
Epoch 1 best val f1 0.3416 test f1 0.39325112104415894
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.14it/s]
Epoch 2 Loss: 0.4145
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.96it/s]
Epoch 2 best val f1 0.5372 test f1 0.5091725587844849

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 3 best val f1 0.5855 test f1 0.4554372727870941
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 4 Loss: -0.1979
Epoch 5 Loss: -0.2861
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
Epoch 10 Loss: -0.4315
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 11 Loss: -0.4618
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 12 Loss: -0.4919
Epoch 13 Loss: -0.5214
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.18it/s]
Epoch 18 Loss: -0.6705
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 19 Loss: -0.6924
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
Epoch 20 Loss: -0.7109
Epoch 21 Loss: -0.7412
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.18it/s]
Epoch 25 Loss: -0.8098
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 26 Loss: -0.8160
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 27 Loss: -0.8382
Epoch 28 Loss: -0.8492
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 29 Loss: -0.8600
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 34 Loss: -0.8970
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 35 Loss: -0.9038
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 36 Loss: -0.9099
Epoch 37 Loss: -0.9135
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.19it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 42 Loss: -0.9332
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.18it/s]
Epoch 43 Loss: -0.9362
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 44 Loss: -0.9385
Epoch 45 Loss: -0.9396
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.19it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.89it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 50 Loss: -0.9523
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 51 Loss: -0.9538
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 52 Loss: -0.9552
Epoch 53 Loss: -0.9573
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
Epoch 54 Loss: -0.9587
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.07it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 59 Loss: -0.9627
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 60 Loss: -0.9641
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 61 Loss: -0.9652
Epoch 62 Loss: -0.9640
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.79it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.14it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.67it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
Epoch 67 Loss: -0.9699
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
Epoch 68 Loss: -0.9720
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 69 Loss: -0.9723
Epoch 70 Loss: -0.9733
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.02it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 75 Loss: -0.9672
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 76 Loss: -0.9676
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 77 Loss: -0.9705
Epoch 78 Loss: -0.9739
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.01it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.02it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 83 Loss: -0.9771
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 84 Loss: -0.9783
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.19it/s]
Epoch 85 Loss: -0.9772
Epoch 86 Loss: -0.9800
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 91 Loss: -0.9818
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 92 Loss: -0.9814
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 93 Loss: -0.9815
Epoch 94 Loss: -0.9817
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 95 Loss: -0.9832
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
Epoch 97 Loss: -0.9827
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 99 Loss: -0.9846
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 100 Loss: -0.9838