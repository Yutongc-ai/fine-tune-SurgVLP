/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
loading num parts:  0
loading num parts:  1
loading num parts:  2
loading num parts:  3
loading num parts:  4
  0%|                                                                          | 0/7 [00:00<?, ?it/s]
num_shots is  64



100%|██████████████████████████████████████████████████████████████████| 7/7 [00:04<00:00,  1.65it/s]
Epoch 1 Loss: 0.5459
 14%|█████████▍                                                        | 1/7 [00:00<00:03,  1.85it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]
Epoch 2 Loss: -0.1563
Epoch 2 best val f1 0.6429 test f1 0.44174814224243164
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 3 Loss: -0.5734


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 4 Loss: -0.9618


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 5 Loss: -1.3668

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
Epoch 6 Loss: -1.8239


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 7 Loss: -2.3552
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  2.00it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  2.00it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 26 Loss: -15.5866

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 27 Loss: -16.3492


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 28 Loss: -17.1416

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 29 Loss: -17.9370


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
Epoch 30 Loss: -18.7595

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
Epoch 31 Loss: -19.5487


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 32 Loss: -20.2498

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 33 Loss: -21.1206


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]
Epoch 34 Loss: -21.9037

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 35 Loss: -22.6485


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 36 Loss: -23.4785

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 37 Loss: -24.2220


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 38 Loss: -25.0347

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]
Epoch 39 Loss: -25.8622


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]
Epoch 40 Loss: -26.6272

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
Epoch 41 Loss: -27.4809


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 42 Loss: -28.3276

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 43 Loss: -29.0979


100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
Epoch 44 Loss: -29.8553
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]
 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.81it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.89it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:01,  2.00it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.99it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.94it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]

 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.92it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  2.00it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.99it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.94it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.94it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
Epoch 75 Loss: -55.2401

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
Epoch 77 Loss: -56.9288

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.93it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.97it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.87it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.88it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]
 43%|████████████████████████████▎                                     | 3/7 [00:01<00:02,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.95it/s]

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.92it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.94it/s]
Epoch 88 Loss: -65.7504

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
Epoch 90 Loss: -67.5659

 71%|███████████████████████████████████████████████▏                  | 5/7 [00:02<00:01,  1.91it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.93it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.94it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.92it/s]

 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.98it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]

 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.92it/s]

100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.91it/s]
 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.82it/s]
 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.82it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.86it/s]
 29%|██████████████████▊                                               | 2/7 [00:01<00:02,  2.00it/s]
 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]
 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.98it/s]
  0%|                                                                          | 0/7 [00:00<?, ?it/s]
 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.96it/s]
 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
 29%|██████████████████▊                                               | 2/7 [00:01<00:02,  1.96it/s]
 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.95it/s]
 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.95it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
  0%|                                                                          | 0/7 [00:00<?, ?it/s]
 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.95it/s]
 57%|█████████████████████████████████████▋                            | 4/7 [00:02<00:01,  1.95it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.96it/s]
 29%|██████████████████▊                                               | 2/7 [00:01<00:02,  1.97it/s]
 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]
 86%|████████████████████████████████████████████████████████▌         | 6/7 [00:03<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 7/7 [00:03<00:00,  1.97it/s]