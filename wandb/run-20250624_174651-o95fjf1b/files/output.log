/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
num_shots is  16
num_shots is  16
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
Epoch 1 Loss: 0.8516
Epoch 1 best val f1 0.2667 test f1 0.31681516766548157
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 2 Loss: 0.0978
Epoch 2 best val f1 0.5124 test f1 0.4935237765312195
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 3 Loss: -0.1556
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 3 best val f1 0.5396 test f1 0.44672340154647827
Epoch 4 Loss: -0.3163
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 5 Loss: -0.4258
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 6 Loss: -0.4863
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 7 Loss: -0.5586
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.01it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.31it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.02it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 12 Loss: -1.0413
Epoch 12 best val f1 0.5410 test f1 0.44275984168052673
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 13 Loss: -1.1671
Epoch 13 best val f1 0.5425 test f1 0.4413261413574219
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 14 Loss: -1.2567
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 15 Loss: -1.3874
Epoch 15 best val f1 0.5470 test f1 0.45114821195602417
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 16 Loss: -1.5081
Epoch 16 best val f1 0.5485 test f1 0.45221519470214844
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 17 Loss: -1.6318
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 18 Loss: -1.7577
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
Epoch 19 Loss: -1.8990
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
Epoch 20 Loss: -2.0296
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 21 Loss: -2.1763
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 26 Loss: -2.9270
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 27 Loss: -3.0884
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 28 Loss: -3.2360
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 29 Loss: -3.4202
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.75it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.11it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 34 Loss: -4.3169
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 35 Loss: -4.4820
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 36 Loss: -4.6819
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 37 Loss: -4.8647
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.01it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 42 Loss: -5.8415
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 43 Loss: -6.0183
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 44 Loss: -6.2248
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 45 Loss: -6.4397
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 49 Loss: -7.2974
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 50 Loss: -7.4983
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
Epoch 51 Loss: -7.7346
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
Epoch 52 Loss: -7.9497
Epoch 53 Loss: -8.1181
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.01it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 57 Loss: -8.9870
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
Epoch 58 Loss: -9.2550
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 59 Loss: -9.3490
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 60 Loss: -9.6477
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 65 Loss: -10.7871
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 66 Loss: -11.0707
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 67 Loss: -11.2620
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 68 Loss: -11.5523
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.06it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 73 Loss: -12.7100
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 74 Loss: -12.9666
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 75 Loss: -13.2062
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 76 Loss: -13.4140
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 80 Loss: -14.3946
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 81 Loss: -14.5981
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 82 Loss: -14.8284
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
Epoch 83 Loss: -15.0696
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 84 Loss: -15.3161
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.02it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 88 Loss: -16.3110
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 89 Loss: -16.5467
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 90 Loss: -16.7922
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 91 Loss: -17.0031
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.01it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.93it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 96 Loss: -18.2378
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.30it/s]
Epoch 97 Loss: -18.4890
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
Epoch 98 Loss: -18.7317
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 99 Loss: -18.9341
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.29it/s]