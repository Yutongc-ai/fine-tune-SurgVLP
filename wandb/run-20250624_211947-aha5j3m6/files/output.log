/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
loading num parts:  1
loading num parts:  2
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
loading num parts:  3
loading num parts:  4
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
num_shots is  16
num_shots is  16

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.50it/s]
Epoch 1 best val f1 0.2581 test f1 0.3407506048679352
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 2 Loss: 0.4011
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 2 best val f1 0.5370 test f1 0.513066291809082

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 3 best val f1 0.5734 test f1 0.4827877879142761
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 4 Loss: -0.1590
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 5 Loss: -0.2910
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 6 Loss: -0.3006
Epoch 7 Loss: -0.3425
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.19it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.95it/s]

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 11 Loss: -0.4592
Epoch 12 Loss: -0.4876
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.14it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 13 Loss: -0.5190
Epoch 14 Loss: -0.5473
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
Epoch 15 Loss: -0.5826
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
Epoch 15 best val f1 0.5738 test f1 0.4254096746444702
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 17 Loss: -0.6381
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 18 Loss: -0.6678
Epoch 19 Loss: -0.6874
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 20 Loss: -0.7162
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 20 best val f1 0.5791 test f1 0.45421546697616577
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 22 Loss: -0.7533
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 23 Loss: -0.7726
Epoch 24 Loss: -0.7892
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
Epoch 24 best val f1 0.5806 test f1 0.45587342977523804
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.19it/s]
Epoch 26 Loss: -0.8167
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 27 Loss: -0.8323
Epoch 27 best val f1 0.5903 test f1 0.4503767788410187
Epoch 28 Loss: -0.8432
Epoch 29 Loss: -0.8553
Epoch 30 Loss: -0.8629
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.95it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 32 Loss: -0.8805
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 33 Loss: -0.8897
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 34 Loss: -0.8966
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 35 Loss: -0.9019
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.00it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.91it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.94it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 40 Loss: -0.9260
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 41 Loss: -0.9297
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 42 Loss: -0.9328
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 43 Loss: -0.9264
Epoch 44 Loss: -0.9387
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.15it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 48 Loss: -0.9467
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 49 Loss: -0.9474
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
Epoch 50 Loss: -0.9509
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 51 Loss: -0.9534
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 52 Loss: -0.9545
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.95it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.98it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 57 Loss: -0.9585
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 58 Loss: -0.9630
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
Epoch 59 Loss: -0.9628
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 60 Loss: -0.9644
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
Epoch 65 Loss: -0.9677
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
Epoch 66 Loss: -0.9699
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 67 Loss: -0.9684
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.15it/s]
Epoch 68 Loss: -0.9709
Epoch 69 Loss: -0.9719
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.91it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.92it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
Epoch 74 Loss: -0.9738
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 75 Loss: -0.9755
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
Epoch 76 Loss: -0.9759
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 77 Loss: -0.9767
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.17it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.18it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.97it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 82 Loss: -0.9791
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.21it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.23it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.20it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 83 Loss: -0.9787
Epoch 84 Loss: -0.9747
Epoch 85 Loss: -0.9782
Epoch 86 Loss: -0.9745
Epoch 87 Loss: -0.9793
Epoch 88 Loss: -0.9792
Epoch 89 Loss: -0.9802
Epoch 90 Loss: -0.9738
Epoch 91 Loss: -0.9811
Epoch 92 Loss: -0.9739
Epoch 93 Loss: -0.9769
Epoch 94 Loss: -0.9810
Epoch 95 Loss: -0.9814
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.96it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.93it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 98 Loss: -0.9762
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 99 Loss: -0.9774
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 100 Loss: -0.9787