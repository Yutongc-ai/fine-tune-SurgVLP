/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
loading num parts:  1
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
loading num parts:  2
loading num parts:  3
loading num parts:  4
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 11.60it/s]
num_shots is  1
num_shots is  1
Epoch 1 Loss: 5.2859
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.18it/s]
Epoch 1 best val f1 0.4138 test f1 0.559295117855072
Epoch 2 Loss: 4.0048
Epoch 2 best val f1 0.4545 test f1 0.5772945880889893
Epoch 3 Loss: 0.1798
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 12.97it/s]
Epoch 3 best val f1 0.4762 test f1 0.3932695686817169
Epoch 4 Loss: -1.1242
Epoch 5 Loss: -2.1233
Epoch 6 Loss: -3.2306
Epoch 7 Loss: -4.7001
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.27it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 16.99it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 13.97it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 16.92it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.36it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.37it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.32it/s]
  0%|                                                                          | 0/1 [00:00<?, ?it/s]
Epoch 8 Loss: -5.3747
Epoch 9 Loss: -5.9584
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.36it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.36it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 16.61it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.36it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.36it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.40it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.44it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.44it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 16.92it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.41it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.44it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.39it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.44it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.40it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.40it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 16.94it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.21it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.42it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.32it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.40it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.02it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.39it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.07it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.47it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.37it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.38it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.46it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.34it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.41it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.44it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.37it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.44it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.33it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.28it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.36it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.06it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.40it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.33it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.40it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.42it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.27it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.37it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.37it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.38it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.38it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.41it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.43it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 16.22it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.44it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.33it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.39it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.36it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.39it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.38it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.39it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.42it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.41it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.38it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.44it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.43it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.46it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.40it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.45it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.32it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.45it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.42it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.41it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.45it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.42it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.34it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.41it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.46it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.47it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.50it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.49it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.51it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 15.09it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.32it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.23it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.14it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.41it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.42it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.40it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.39it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.37it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.33it/s]
100%|██████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.32it/s]
  0%|                                                                          | 0/1 [00:00<?, ?it/s]
Traceback (most recent call last):
  File "few_shot.py", line 80, in <module>
    main(configs[args.method], args.method)
  File "few_shot.py", line 56, in main
    metrics = method(dataset)
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yongxuan/SurgVLP/methods/zoom_in.py", line 201, in forward
    for i, (images, target) in enumerate(tqdm(train_loader)):
  File "/home/yongxuan/.local/lib/python3.8/site-packages/tqdm/std.py", line 1195, in __iter__
    for obj in iterable:
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torch/utils/data/dataloader.py", line 630, in __next__
    data = self._next_data()
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torch/utils/data/dataloader.py", line 673, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/home/yongxuan/SurgVLP/datasets/utils.py", line 306, in __getitem__
    img = self._transform_image(self.transform, img0)
  File "/home/yongxuan/SurgVLP/datasets/utils.py", line 321, in _transform_image
    img_list.append(tfm(img0))
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torchvision/transforms/transforms.py", line 95, in __call__
    img = t(img)
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torchvision/transforms/transforms.py", line 354, in forward
    return F.resize(img, self.size, self.interpolation, self.max_size, self.antialias)
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torchvision/transforms/functional.py", line 477, in resize
    return F_pil.resize(img, size=output_size, interpolation=pil_interpolation)
  File "/home/yongxuan/.local/lib/python3.8/site-packages/torchvision/transforms/_functional_pil.py", line 250, in resize
    return img.resize(tuple(size[::-1]), interpolation)
  File "/home/yongxuan/.local/lib/python3.8/site-packages/PIL/Image.py", line 2115, in resize
    return self._new(self.im.resize(size, resample, box))
KeyboardInterrupt
Epoch 11 Loss: -7.6905
Epoch 12 Loss: -8.3641
Epoch 13 Loss: -9.1485
Epoch 14 Loss: -9.9598
Epoch 15 Loss: -10.7258
Epoch 16 Loss: -11.5544
Epoch 17 Loss: -12.4804
Epoch 18 Loss: -13.3153
Epoch 19 Loss: -14.2572
Epoch 20 Loss: -15.2781
Epoch 21 Loss: -16.2908
Epoch 22 Loss: -17.3423
Epoch 23 Loss: -18.4940
Epoch 24 Loss: -19.5324
Epoch 25 Loss: -20.6677
Epoch 26 Loss: -21.9088
Epoch 27 Loss: -23.1552
Epoch 28 Loss: -24.4027
Epoch 29 Loss: -25.6572
Epoch 30 Loss: -27.0294
Epoch 31 Loss: -28.3423
Epoch 32 Loss: -29.8018
Epoch 33 Loss: -31.2528
Epoch 34 Loss: -32.7201
Epoch 35 Loss: -34.1583
Epoch 36 Loss: -35.6667
Epoch 37 Loss: -37.0651
Epoch 38 Loss: -38.4561
Epoch 39 Loss: -40.1311
Epoch 40 Loss: -41.5975
Epoch 41 Loss: -43.0991
Epoch 42 Loss: -44.6179
Epoch 43 Loss: -46.1832
Epoch 44 Loss: -47.7810
Epoch 45 Loss: -49.4151
Epoch 46 Loss: -51.1751
Epoch 47 Loss: -52.7907
Epoch 48 Loss: -54.4719
Epoch 49 Loss: -56.0749
Epoch 50 Loss: -57.9026
Epoch 51 Loss: -59.7076
Epoch 52 Loss: -61.4966
Epoch 53 Loss: -63.3203
Epoch 54 Loss: -65.0524
Epoch 55 Loss: -66.9338
Epoch 56 Loss: -68.8152
Epoch 57 Loss: -70.6041
Epoch 58 Loss: -72.3023
Epoch 59 Loss: -74.1572
Epoch 60 Loss: -76.1073
Epoch 61 Loss: -77.9967
Epoch 62 Loss: -79.7789
Epoch 63 Loss: -81.6497
Epoch 64 Loss: -83.4982
Epoch 65 Loss: -85.2854
Epoch 66 Loss: -87.2543
Epoch 67 Loss: -89.1081
Epoch 68 Loss: -91.1436
Epoch 69 Loss: -92.8736
Epoch 70 Loss: -94.8084
Epoch 71 Loss: -96.6376
Epoch 72 Loss: -98.5100
Epoch 73 Loss: -100.4504
Epoch 74 Loss: -102.2928
Epoch 75 Loss: -104.2931
Epoch 76 Loss: -106.2387
Epoch 77 Loss: -108.1145
Epoch 78 Loss: -110.1527
Epoch 79 Loss: -111.8504
Epoch 80 Loss: -113.8820
Epoch 81 Loss: -115.7811
Epoch 82 Loss: -117.9029
Epoch 83 Loss: -119.8136
Epoch 84 Loss: -121.7648
Epoch 85 Loss: -123.6908
Epoch 86 Loss: -125.5351
Epoch 87 Loss: -127.5962
Epoch 88 Loss: -129.6650
Epoch 89 Loss: -131.6432
Epoch 90 Loss: -133.6702
Epoch 91 Loss: -135.5855
Epoch 92 Loss: -137.5241
Epoch 93 Loss: -139.5634
Epoch 94 Loss: -141.4991
Epoch 95 Loss: -143.4404
Epoch 96 Loss: -145.3186
Epoch 97 Loss: -147.2718