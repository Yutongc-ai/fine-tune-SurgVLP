/home/yongxuan/anaconda3/envs/clip/lib/python3.8/site-packages/huggingface_hub/file_download.py:943: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/home/yongxuan/SurgVLP/datasets/utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  features = torch.load(f"{cfg.cache_dir}/{split}local_f_part{part_idx}.pt")
loading num parts:  0
num_shots is  16
num_shots is  16
/home/yongxuan/SurgVLP/datasets/utils.py:75: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  labels = torch.load(f"{cfg.cache_dir}/{split}local_l_part{part_idx}.pt")
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.54it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.50it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 1 best val f1 0.3150 test f1 0.3260299563407898

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.79it/s]
Epoch 2 best val f1 0.5534 test f1 0.5251505374908447
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.97it/s]
Epoch 3 Loss: -0.1193
Epoch 3 best val f1 0.5972 test f1 0.47428804636001587
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
Epoch 4 Loss: -0.3101
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.04it/s]
Epoch 5 Loss: -0.4242
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
Epoch 6 Loss: -0.4956
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.08it/s]
Epoch 7 Loss: -0.5798
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.10it/s]
Epoch 8 Loss: -0.6730
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.10it/s]
Epoch 9 Loss: -0.7669
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.09it/s]
Epoch 10 Loss: -0.8689
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.93it/s]
Epoch 11 Loss: -0.9576
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.00it/s]
Epoch 12 Loss: -1.0706
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
Epoch 13 Loss: -1.1805
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
Epoch 14 Loss: -1.2835
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  2.00it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]

100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.76it/s]
Epoch 17 Loss: -1.6524
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.02it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 18 Loss: -1.7820
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.91it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 20 Loss: -2.0390
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.02it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.00it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.02it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.14it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.14it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.76it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.85it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.09it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.76it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.02it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
Epoch 30 Loss: -3.6249
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
Epoch 31 Loss: -3.7884
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.11it/s]
Epoch 32 Loss: -3.9718
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.47it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.85it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.04it/s]
Epoch 34 Loss: -4.3303
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
Epoch 35 Loss: -4.5128
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.11it/s]
Epoch 36 Loss: -4.7196
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.11it/s]
Epoch 37 Loss: -4.8747
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.00it/s]
Epoch 38 Loss: -5.0692
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.99it/s]
Epoch 39 Loss: -5.2605
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.81it/s]
Epoch 40 Loss: -5.4399
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.93it/s]
Epoch 41 Loss: -5.6559
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.13it/s]
Epoch 42 Loss: -5.8596
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.12it/s]
Epoch 43 Loss: -6.0519
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.16it/s]
Epoch 44 Loss: -6.2651
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.91it/s]
Epoch 45 Loss: -6.4404
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  2.00it/s]
Epoch 46 Loss: -6.6696
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.98it/s]
Epoch 47 Loss: -6.8568
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.08it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.13it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 49 Loss: -7.2762
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.11it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.01it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.87it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.95it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.03it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.03it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.13it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 54 Loss: -8.4635
Epoch 55 Loss: -8.6663
Epoch 56 Loss: -8.9270
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.01it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.79it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.90it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.93it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.11it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.95it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.94it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.11it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.02it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.81it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.07it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.84it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.05it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.81it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.06it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.55it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.88it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.87it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.06it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.95it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.65it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:01<00:00,  1.92it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
Epoch 73 Loss: -12.8307
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 74 Loss: -13.1208
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
Epoch 75 Loss: -13.3576
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 76 Loss: -13.5881
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.22it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 80 Loss: -14.4549
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
Epoch 81 Loss: -14.7510
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 82 Loss: -14.8993
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 83 Loss: -15.1907
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 84 Loss: -15.4551
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.27it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.95it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 88 Loss: -16.4478
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 89 Loss: -16.7251
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 90 Loss: -16.9598
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 91 Loss: -17.2041
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  1.99it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
 50%|█████████████████████████████████                                 | 1/2 [00:00<00:00,  2.00it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 96 Loss: -18.4522
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 97 Loss: -18.6886
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.28it/s]
Epoch 98 Loss: -18.8769
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.24it/s]
  0%|                                                                          | 0/2 [00:00<?, ?it/s]
Epoch 99 Loss: -19.1644
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]
100%|██████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.26it/s]